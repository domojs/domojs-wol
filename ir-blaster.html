<section>
	<header>
		<title>Télécommande</title>
	</header>
	<article class="ir">
		<script type="text/javascript"><![CDATA[

		function buildBlocks(device)
		{
			var newName=device.name;
			switch(newName)
			{
				case 'Creative Audio Accessory':
					newName='Enceintes';
					break;
				case 'Freebox AV System':
					newName='Freebox';
					break;
				case 'Creative Digital Media Receiver - Audio':
					newName='Décodeur';
					break;
				case 'Samsung TV':
					newName='TV';
					break;
				case 'Belkin Video Accessory':
					newName='HDMI switcher';
					break;
				case 'Thermaltake Home Theater System':
					newName='PC';
					break;
			}
			device.name=newName;
			return $('<div class="block block-256 block-noimg"></div>').append(buildBlock0(device)
			.add(buildBlock1(device))
			.add(buildBlock2(device))
			.add(buildBlock3(device)));
		}
		
		function buildBlock0(device)
		{
			var block=$('<div class="block block-128 block-noimg"></div>');
			$.getJSON('/api/ir-blaster/'+device.dev+'/commands',function (data){
				if($.grep(data, function(e){ return e.name=='POWER TOGGLE' }).length>0)
				{
					block.removeClass('block-noimg').addClass('icon-128 icon-power-128').click(function(){
						$.get('/api/ir-blaster/blast/'+device.dev+'/POWER TOGGLE',function(data){
							$('#log').prepend(data);
						});
					});
				}
			});
			return block;
		}
		function buildBlock1(device)
		{
			var block=$('<div class="block block-128 block-noimg"></div>');
			switch(device.name)
			{
				case 'Freebox':
					block.removeClass('block-noimg').addClass('icon-128 icon-up-128').click(function(){
					$.get('/api/ir-blaster/blast/'+device.dev+'/VOLUME UP',function(data){
						$('#log').prepend(data);
					});
					});
				break;
				case 'Décodeur':
					block.text('Optical switch').click(function(){
					$.get('/api/ir-blaster/blast/'+device.dev+'/Optical switch',function(data){
						$('#log').prepend(data);
					});
					});
				break;
				case 'TV':
					block.text('HDMI 1').click(function(){
						$.get('/api/ir-blaster/blast/'+device.dev+'/INPUT HDMI 1',function(data){
							$('#log').prepend(data);
						});
					});
				break;
			}
			return block;
		}
		
		function buildBlock2(device)
		{
			var block=$('<div class="block block-128 icon-128 block-noimg"></div>');
			block.text(device.name);
			return block;
		}
		function buildBlock3(device)
		{
			var block=$('<div class="block block-128 block-noimg"></div>');
			switch(device.name)
			{
				case 'Freebox':
					block.removeClass('block-noimg').addClass('icon-128 icon-down-128').click(function(){
					$.get('/api/ir-blaster/blast/'+device.dev+'/VOLUME DOWN',function(data){
						$('#log').prepend(data);
					});
					});
				break;
				case 'TV':
					block.text('HDMI 2').click(function(){
						$.get('/api/ir-blaster/blast/'+device.dev+'/INPUT HDMI 2',function(data){
							$('#log').prepend(data);
						});
					});
				break;
			}		
			return block;
		}
		
		$.getJSON('/api/ir-blaster/devices', 
			function(data)
			{
				$.each(data, function(){
					$('article').append(buildBlocks(this));
				});
			}
		);
		]]></script>
	</article>
</section>